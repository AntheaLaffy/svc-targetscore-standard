# SVC模型评分系统

SVC模型评分系统是一个专业的声线转换模型评估工具，基于《SVC评分指南》中的四维评分体系开发。系统采用科学的压制算法，能够对SVC模型转换效果进行客观、全面的评估。

## 核心特性

- 🎵 **专业评估**：基于声学原理的10维度评分体系
- 📊 **智能压制**：Sigmoid函数压制算法，惩罚低分维度
- 🔄 **完整历史**：支持撤销/重做操作
- 💾 **持久存储**：自动保存和断点恢复功能
- ⚙️ **灵活配置**：可调整维度权重和压制参数
- 🖨️ **丰富输出**：支持多种格式的报告生成

## 系统架构

```
SVC评分系统
├── 四维评分体系 (权重100%)
│   ├── 音色相似度 (30%)
│   │   ├── 基频分布匹配度
│   │   ├── 共振峰结构相似度
│   │   └── 谐波能量分布匹配
│   ├── 演唱风格相似度 (20%)
│   │   ├── 颤音特征一致性
│   │   └── 动态处理相似度
│   ├── 音频质量参数 (25%)
│   │   ├── 噪声与伪影控制
│   │   ├── 频谱连续性
│   │   └── 相位一致性
│   └── 自然度 (25%)
│       ├── 发音清晰度
│       └── 气息自然度
└── 压制算法
    ├── 严格模式 (左阀门0.2, 右阀门0.8)
    ├── 标准模式 (左阀门0.1, 右阀门0.7)
    └── 宽松模式 (左阀门0.0, 右阀门0.6)
```

## 快速开始

### 环境要求

- Python 3.7+

### 安装运行

```bash
# 运行系统
python targetscore.py
```

### 首次使用

1. 启动系统

```bash
python targetscore.py
```

2. 创建评分会话

```
=== SVC模型评分系统（基于SVC初学者指南）===

请选择操作:
1. 开始新评分
2. 继续现有评分
3. 系统管理
4. 退出系统

请输入选择 (1-4): 1
```

3. 输入模型信息

```
请输入模型名称: kiritan
请输入训练轮数: 100
```

4. 开始评分

```
开始为模型 kiritan (轮数: 100) 进行SVC评分

当前进度: 1/26
当前歌曲: CN1(不怕，可爱积极) (CN)
请按以下顺序输入10个维度的评分(0-10分):
1. 基频分布匹配度 (pitch_match)
2. 共振峰结构相似度 (formant_similarity)
...
10. 气息自然度 (breath_naturalness)

请输入10个评分 (用空格分隔) 或命令: 8.5 7.8 8.2 7.5 8.0 9.0 8.8 8.5 8.2 8.0
```

## 评分体系详解

### 四维评分架构

系统采用四维评分体系，每个维度包含多个子维度：

#### 1. 音色相似度 (权重30%)

- **基频分布匹配度**
  - 评估转换后声音的音高变化模式是否与目标声线一致
  - 低分表现：音高起伏生硬，没有目标声线的特色
  - 高分表现：音高变化自然，完美复现目标声线的演唱习惯

- **共振峰结构相似度**
  - 评估声道特征是否接近目标声线
  - 低分表现：声音"薄厚"感错误，一听就是假的
  - 高分表现：共鸣点位置准确，听起来很真实

- **谐波能量分布匹配**
  - 评估高、中、低频能量比例是否匹配
  - 低分表现：某些频段太突出或缺失，听起来不自然
  - 高分表现：频谱包络自然，各频段能量协调

#### 2. 演唱风格相似度 (权重20%)

- **颤音特征一致性**
  - 评估颤音的深度、速度、启动模式是否一致
  - 低分表现：颤音机械、不自然或完全没有
  - 高分表现：颤音细腻，符合目标声线的演唱习惯

- **动态处理相似度**
  - 评估强弱变化、气息控制的处理方式
  - 低分表现：音量变化生硬，缺乏细腻的渐强渐弱
  - 高分表现：动态处理自然，情感表达到位

#### 3. 音频质量参数 (权重25%)

- **噪声与伪影控制**
  - 评估背景噪声、电音感、爆破音等不良声音的多少
  - 低分表现：明显机械声、嗡嗡声、噼啪声
  - 高分表现：声音干净，没有明显加工痕迹

- **频谱连续性**
  - 评估声音在时间上的连续性
  - 低分表现：声音抖动、断断续续，有"跳帧"感
  - 高分表现：声音流畅，过渡自然

- **相位一致性**
  - 评估声波相位是否稳定
  - 低分表现：声音发虚、定位模糊
  - 高分表现：声音结实，声像稳定

#### 4. 自然度 (权重25%)

- **发音清晰度**
  - 评估歌词是否清晰可辨，辅音是否完整
  - 低分表现：咬字模糊，特别是辅音丢失严重
  - 高分表现：字正腔圆，每个音节都清晰自然

- **气息自然度**
  - 评估换气、气口是否真实自然
  - 低分表现：气息处理生硬，换气声异常或缺失
  - 高分表现：呼吸节奏自然，符合生理规律

### 评分标准层次

每个子维度采用10分制评分，具体标准如下：

| 分数 | 等级 | 描述 |
|------|------|------|
| 9-10分 | 专业级 | 专业监听环境下也难以区分，特征完全一致，无法分辨真伪，与真人演唱无差别 |
| 7-8分 | 优秀级 | 特征高度一致，细节丰富，处理流畅自然，情感表达到位，极轻微加工痕迹 |
| 5-6分 | 良好级 | 主要特征匹配，整体协调，基本自然，主要参数正确，轻微噪声或偏差 |
| 3-4分 | 及格级 | 基本特征存在但不够自然，主要元音/动态基本正确，可察觉的噪声和偏差 |
| 1-2分 | 不及格 | 特征严重错误或缺失，明显机械感或不自然，严重影响听感 |
| 0分 | 完全失败 | 与推理源一致，模型宕机，完全无法接受的质量问题 |

## 压制算法

### 算法原理

系统采用Sigmoid函数进行压制计算：

```
压制因子 = 1 / (1 + e^(-k × (x - θ)))
```

其中：
- x = 最差维度分数 / 10.0 (归一化)
- θ = (左阀门 + 右阀门) / 2
- k = 4 / (右阀门 - 左阀门)

### 压制配置

系统提供三种压制模式：

#### 严格模式

```python
{
    'left_valve': 0.2,   # 2分开始压制
    'right_valve': 0.8,  # 8分结束压制
    'theta': 0.5,        # 压制中点
    'k': 6.67           # 压制强度
}
```

- 适用场景：高质量要求，产品化前检验
- 压制效果：对6分以下维度进行显著压制

#### 标准模式

```python
{
    'left_valve': 0.1,   # 1分开始压制
    'right_valve': 0.7,  # 7分结束压制
    'theta': 0.4,        # 压制中点
    'k': 6.67           # 压制强度
}
```

- 适用场景：常规测试，模型对比
- 压制效果：对5分以下维度进行适度压制

#### 宽松模式

```python
{
    'left_valve': 0.0,   # 0分开始压制
    'right_valve': 0.6,  # 6分结束压制
    'theta': 0.3,        # 压制中点
    'k': 6.67           # 压制强度
}
```

- 适用场景：早期研发，快速迭代
- 压制效果：对4分以下维度进行轻度压制

### 压制效果示例

| 最差维度分 | 严格模式 | 标准模式 | 宽松模式 | 说明 |
|------------|----------|----------|----------|------|
| 0.0 | 0.001 | 0.006 | 0.047 | 几乎完全压制 |
| 1.0 | 0.006 | 0.047 | 0.269 | 重度压制 |
| 2.0 | 0.047 | 0.269 | 0.500 | 中度压制 |
| 3.0 | 0.269 | 0.500 | 0.731 | 中轻度压制 |
| 4.0 | 0.500 | 0.731 | 0.953 | 轻度压制 |
| 5.0 | 0.731 | 0.953 | 0.994 | 轻微压制 |
| 6.0 | 0.953 | 0.994 | 0.999 | 基本无压制 |
| 7.0 | 0.994 | 0.999 | 1.000 | 无压制 |
| 8.0 | 0.999 | 1.000 | 1.000 | 无压制 |

## 评分计算流程

### 完整计算步骤

1. 输入10维度评分

```
用户输入: 8.5 7.8 8.2 7.5 8.0 9.0 8.8 8.5 8.2 8.0
```

2. 计算维度基础分

```
音色相似度 = (8.5 + 7.8 + 8.2) / 3 = 8.17
演唱风格 = (7.5 + 8.0) / 2 = 7.75
音频质量 = (9.0 + 8.8 + 8.5) / 3 = 8.77
自然度 = (8.2 + 8.0) / 2 = 8.10
```

3. 计算加权基础分

```
基础分 = 8.17×0.3 + 7.75×0.2 + 8.77×0.25 + 8.10×0.25 = 8.22
```

4. 找到最差维度

```
最差维度 = min(8.17, 7.75, 8.77, 8.10) = 7.75
```

5. 计算压制因子

```
压制因子 = sigmoid(6.67 × (0.775 - 0.4)) = 0.994
```

6. 计算最终权重

```
最终权重 = 8.22 × 10 × 0.994 = 81.7%
```

7. 计算单曲总分

```
单曲总分 = 81.7% × 9分 = 7.35分
```

## 歌曲权重体系

### 中文歌曲 (CN)

| 类型 | 满分 | 示例 |
|------|------|------|
| 常规歌曲 | 9分 | CN1-CN9 |
| 特殊歌曲 | 4分 | CN-SP |
| 额外歌曲 | 5分 | CN-EX1~3 |

### 日文歌曲 (JP)

| 类型 | 满分 | 示例 |
|------|------|------|
| 常规歌曲 | 8分 | JP1-JP11 |
| 额外歌曲 | 6分 | JP-EX1~2 |

## 合格标准

- 单语种合格: ≥60分
- 单语种优秀: ≥80分
- 总体通过: CN+JP总分 ≥160分

## 命令系统

### 命令概览

系统采用简洁的命令体系，所有命令无需前缀：

| 命令 | 类别 | 描述 | 示例 |
|------|------|------|------|
| help | 查询 | 显示帮助信息 | help -v |
| list | 查询 | 显示评分总览 | list -m kiritan_100 |
| print | 查询 | 打印系统信息 | print -s rules -o y |
| change | 修改 | 修改系统配置 | change -s rules -i '{"weights":{...}}' |
| clear | 修改 | 清空数据 | clear -s scores -c y |
| delete | 修改 | 删除数据 | delete -s session |
| undo | 执行 | 撤销操作 | undo -n 3 |
| redo | 执行 | 重做操作 | redo |
| save | 执行 | 保存数据 | save |
| quit | 执行 | 退出系统 | quit -c y |

### 选项语法

系统使用三类选项控制命令行为：

#### 模式选项 (Mode)

- `-c`: 确认模式 (y/n)
- `-v`: 详细模式 (y/n)
- `-f`: 强制模式 (y/n)
- `-o`: 输出模式 (文件路径)

#### 目标选项 (Target)

- `-m`: 模型相关
- `-s`: 步骤/歌曲相关
- `-r`: 规则相关
- `-l`: 曲库相关
- `-c`: 配置相关
- `-h`: 历史相关

#### 输入选项 (Input)

- `-i`: 输入内容
- `-f`: 文件输入
- `-n`: 数字参数
- `-p`: 路径参数
- `-r`: 范围参数

### 常用命令详解

#### help - 帮助信息

```
help [选项]
```

选项：
- `-v`: 显示详细帮助
- `-c 命令名`: 显示特定命令帮助

示例：
```bash
help          # 显示基础帮助
help -v       # 显示详细帮助
help -c list  # 显示list命令帮助
```

#### list - 评分列表

```
list [选项]
```

选项：
- `-m 模型标识`: 显示指定模型的评分

示例：
```bash
list          # 显示当前会话评分
list -m kiritan_100  # 显示指定模型评分
```

#### print - 信息打印

```
print [选项]
```

选项：
- `-s 对象`: 指定打印对象
  - system: 系统信息
  - rules: 评分规则
  - song_library: 曲库信息
  - scores: 评分信息
  - dimensions: 维度信息
- `-o 文件路径`: 输出到文件

示例：
```bash
print -s system              # 打印系统信息
print -s rules -o rules.txt  # 打印规则到文件
print -s dimensions          # 打印维度详细信息
```

#### change - 配置修改

```
change [选项]
```

选项：
- `-s 对象`: 修改对象
  - system: 系统配置
  - rules: 评分规则
  - song_library: 曲库配置
- `-i JSON数据`: 修改内容
- `-c y/n`: 确认模式

示例：
```bash
# 修改维度权重
change -s rules -i '{"dimensions":{"timbre_similarity":{"weight":0.35}}}'

# 修改压制配置
change -s rules -i '{"suppression_configs":{"strict":{"left_valve":0.3}}}'
```

## 配置管理

### 配置文件结构

系统配置存储在 `svc_scoring_config.json` 文件中：

```json
{
  "command_priority": 1,
  "log_dir": "svc_scoring_logs",
  "auto_save": true,
  "scoring_rules": {
    "dimensions": {
      "timbre_similarity": {
        "weight": 0.30,
        "sub_dimensions": {
          "pitch_match": "基频分布匹配度",
          "formant_similarity": "共振峰结构相似度",
          "spectral_balance": "谐波能量分布匹配"
        }
      },
      // ... 其他维度
    },
    "suppression_configs": {
      "strict": {"left_valve": 0.2, "right_valve": 0.8},
      "standard": {"left_valve": 0.1, "right_valve": 0.7},
      "lenient": {"left_valve": 0.0, "right_valve": 0.6}
    },
    "default_suppression": "standard"
  },
  "song_library": {
    "CN": {...},
    "JP": {...}
  }
}
```

### 配置修改方法

#### 方法1: 使用change命令

```bash
# 修改维度权重
change -s rules -i '{"dimensions":{"timbre_similarity":{"weight":0.35}}}'

# 添加新歌曲
change -s song_library -i '{"CN":{"regular":[{"name":"新歌曲","max_score":9}]}}'

# 修改压制配置
change -s rules -i '{"suppression_configs":{"custom":{"left_valve":0.15,"right_valve":0.75}}}'
```

#### 方法2: 直接编辑配置文件

```bash
# 备份配置
cp svc_scoring_config.json svc_scoring_config.json.backup

# 编辑配置
vim svc_scoring_config.json

# 重启系统生效
```

#### 方法3: 系统管理功能

通过系统管理菜单进行配置备份和恢复。

### 重要配置参数

#### 维度权重调整

- `timbre_similarity`: 音色相似度权重 (默认0.30)
- `style_similarity`: 演唱风格权重 (默认0.20)
- `audio_quality`: 音频质量权重 (默认0.25)
- `naturalness`: 自然度权重 (默认0.25)

#### 压制参数调整

- `left_valve`: 压制开始阈值 (0-1)
- `right_valve`: 压制结束阈值 (0-1)

系统自动计算θ和k值

## 高级功能

### 批量操作

#### 批量修改评分

```bash
# 批量修改多个步骤
change -s 1 2 3 -i '{"pitch_match":9.0}'
```

#### 批量导出数据

```bash
# 导出所有模型评分
print -s scores -o all_scores.txt

# 导出评分规则
print -s rules -o scoring_rules_export.json
```

### 会话管理

#### 查看所有会话

```bash
print -s scores
```

#### 切换会话

```bash
# 退出当前会话
quit

# 选择"继续现有评分"
2

# 选择目标会话
1
```

#### 删除会话

```bash
delete -s session -c y
```

### 数据备份与恢复

#### 手动备份

```bash
# 通过系统管理功能
3 -> 2 (备份系统配置)
```

#### 自动备份

系统会在每次配置修改时自动创建时间戳备份。

#### 恢复备份

```bash
# 通过系统管理功能
3 -> 3 (恢复系统配置)
```

## 使用最佳实践

### 评分技巧

1. **多轮聆听**
   - 第一轮：整体印象评分
   - 第二轮：细节特征分析
   - 第三轮：与原声对比确认

2. **参考标准**
   - 使用print命令查看详细的评分标准
   - 保持评分标准的一致性
   - 重点关注最差维度

3. **环境要求**
   - 使用质量良好的耳机
   - 在安静的环境下评分
   - 避免疲劳评分

### 模型对比

1. **相同歌曲对比**
   - 同一歌曲在不同模型下的表现
   - 关注各维度的改进情况

2. **趋势分析**
   - 随着训练轮数增加的性能变化
   - 识别性能瓶颈维度

3. **配置优化**
   - 根据评分结果调整模型参数
   - 针对性优化低分维度

## 故障排除

### 常见问题

#### Q1: 评分输入格式错误

**问题**: 输入评分时提示格式错误

**解决**: 确保输入10个0-10之间的数字，用空格分隔

```
正确: 8.5 7.8 8.2 7.5 8.0 9.0 8.8 8.5 8.2 8.0
错误: 8.5,7.8,8.2,7.5,8.0,9.0,8.8,8.5,8.2,8.0
错误: 8.5 7.8 8.2 (数量不足)
```

#### Q2: 命令无法识别

**问题**: 输入命令后显示"未知命令"

**解决**:
- 检查命令拼写是否正确
- 使用 help 查看可用命令
- 确保没有多余的空格或特殊字符

#### Q3: 撤销操作无效

**问题**: 使用 undo 命令没有效果

**解决**:
- 确认有操作历史可撤销
- 使用 list 查看当前状态
- 检查是否已保存，已保存的操作可能无法撤销

#### Q4: 会话数据丢失

**问题**: 重新启动后找不到之前的评分数据

**解决**:
- 检查 svc_scoring_logs 目录是否存在
- 使用"继续现有评分"功能
- 确认之前使用了 save 命令保存

#### Q5: 配置修改不生效

**问题**: 修改配置后没有变化

**解决**:
- 确认配置格式正确（有效的JSON）
- 重启系统使配置生效
- 检查配置文件权限

### 日志文件位置

- 系统日志: svc_scoring_logs/
- 配置备份: svc_config_backups/
- 打印输出: print_outputs/

### 恢复损坏配置

```bash
# 1. 删除损坏的配置文件
rm svc_scoring_config.json

# 2. 重新启动系统（会自动生成默认配置）
python targetscore.py

# 3. 从备份恢复配置
选择"系统管理" -> "恢复系统配置"
```

## 性能优化建议

### 系统配置

#### 内存优化

- 定期清理不需要的会话数据
- 使用 clear 命令清空历史记录

#### 存储优化

- 定期备份重要数据后删除旧会话
- 使用 delete 命令删除不需要的会话

#### 性能监控

- 监控日志文件大小
- 定期检查系统资源使用情况

### 使用效率

#### 批量操作

- 使用批处理命令提高效率
- 合理安排评分顺序

#### 模板使用

- 创建常用配置模板
- 使用print命令导出配置供其他项目使用

## 更新日志

### v2.0.0 (当前版本)

- 🎉 基于SVC初学者指南完全重构
- 📊 实现四维10维度评分体系
- ⚙️ 新增压制算法配置
- 🖨️ 增强报告输出功能
- 🔄 优化命令系统

### v1.0.0 (初始版本)

- ✅ 基础DDSP评分功能
- ✅ 基本命令系统
- ✅ 会话管理功能